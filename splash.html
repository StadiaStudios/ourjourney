<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Journey</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.png">
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply the Inter font and set a nice fullscreen background */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 0;
            margin: 0; 
            width: 100%;
            transition: background-color 0.3s; /* Smooth transition for dark mode */
        }
        
        /* New styles for the list display */
        #durationList li {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 500; /* font-medium */
            color: #4a5568; /* gray-700 */
            margin-bottom: 0.75rem;
            text-align: left;
            padding-left: 1.5rem; /* Space for the custom bullet */
            position: relative;
        }
        
        /* Custom heart bullet point */
        #durationList li::before {
            content: '‚ù§Ô∏è';
            position: absolute;
            left: 0;
            color: #d946ef; /* fuchsia-600 */
            font-size: 1rem;
            line-height: 1.5;
        }
        
        /* Style for the numerical value */
        .duration-value {
            font-weight: 800; /* Extra bold for the number */
            color: #be185d; /* Deep pink color for emphasis (Light Mode Default) */
            margin-right: 0.15rem; /* Small gap between number and text */
            transition: color 0.3s; /* Add transition for smoothness */
        }
        
        /* Image container for square aspect ratio and centering */
        #photoContainer {
            width: 100%;
            padding-top: 100%; /* Creates a square aspect ratio using padding trick */
            position: relative;
            background-color: rgb(34, 34, 34); /* Placeholder for dark theme compatibility */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #uploadedImage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        @media (min-width: 640px) {
             #durationList li { font-size: 2rem; }
        }

        /* --- DARK MODE STYLES --- */
        body.dark {
            background-color: #1a202c; /* Darker background */
            color: #e2e8f0; /* Light text */
        }
        
        body.dark .bg-white {
            background-color: #2d3748; /* Header/Card backgrounds */
            color: #e2e8f0;
        }

        body.dark .shadow-lg {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12);
        }

        body.dark #durationList li {
            color: #cbd5e0; /* Light gray text for duration list */
        }
        
        body.dark .text-gray-700 { color: #cbd5e0; }
        body.dark .text-gray-600 { color: #a0aec0; }
        body.dark .text-gray-500 { color: #718096; }
        body.dark .text-gray-400 { color: #4a5568; }

        /* Inverse colors for pink elements and their borders in dark mode for contrast */
        body.dark .bg-pink-50 {
            background-color: #4a5568; /* Dark card background */
        }
        /* Make all pink borders dark grey for consistency and contrast */
        body.dark .border-pink-100,
        body.dark .border-pink-200,
        body.dark .border-pink-300,
        body.dark .border-pink-400 { 
             border-color: #4a5568; /* Dark gray border */
        }
        body.dark .text-pink-600, body.dark .text-pink-700 { color: #ff5f5f; /* Orange accent in dark mode */ }

        /* NEW: Set the duration count to light red in dark mode */
        body.dark .duration-value {
            color: #ff5656; /* Tailwind's red-300 (A light red color) */
        }
        
        /* Fix for Date Input in Dark Mode */
        body.dark input[type="date"] {
            color: #e2e8f0; /* White/light text */
            background-color: #2d3748; /* Dark background */
            border-color: #4a5568; /* Darker border */
        }
    </style>
</head>
<body>
    
    <!-- Sticky Top Header -->
    <header class="fixed top-0 left-0 w-full z-50 bg-white shadow-lg p-4 text-center border-b border-pink-100 flex justify-between items-center">
        <a href="settings.html" class="text-gray-500 hover:text-pink-600 transition duration-150">
            <!-- Settings Icon (Cog) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.35a2 2 0 0 0 .73 2.73l.15.08a2 2 0 0 1 1 1.74v.44a2 2 0 0 1-1 1.73l-.15.08a2 2 0 0 0-.73 2.73l.78 1.35a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.35a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.44a2 2 0 0 1 1-1.73l.15-.08a2 2 0 0 0 .73-2.73l-.78-1.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>
            </svg>
        </a>
        <h1 class="text-2xl font-extrabold text-pink-700" id="mainTitle">Our Journeyüíñ</h1>
        <p class="text-sm w-8"></p><!-- Spacer for alignment -->
        <p id="dateDisplay" class="text-sm text-gray-600 font-medium absolute right-1/2 translate-x-1/2 bottom-1">
            <!-- Date will be displayed here --></p>
    </header>

    <!-- Main App Content (Padding added to account for fixed header height) -->
    <div id="app" class="w-full max-w-xl px-6 md:px-8 text-center transition-all duration-300" style="padding-top: 7rem; padding-bottom: 2rem;">
        
        <!-- Welcome Message (Visible if no date is set) -->
        <div id="welcomeMessage" class="p-8 mb-8 bg-pink-50 rounded-xl border-2 border-pink-300 shadow-lg hidden">
            <h2 class="text-2xl font-bold text-pink-600 mb-4">Welcome to <span id="welcomeNames"></span>'s Journey!</h2>
            <p class="text-gray-700 text-lg">To begin tracking your time together, please set your relationship start date below.</p>
            <p class="text-sm text-gray-500 mt-4">All your data, including your photo, is saved securely on this device.</p>
        </div>
        
        <!-- Photo Section (Conditional Display) -->
        <div id="photoWrapper" class="mb-8 p-4 hidden">
            <div id="photoContainer" class="relative rounded-lg overflow-hidden border-4 border-pink-400 mb-4 mx-auto max-w-xs md:max-w-sm shadow-xl cursor-pointer">
                <img id="uploadedImage" src="" alt="Our Couple Photo" class="w-full h-full object-cover hidden">
                <p id="photoPlaceholder" class="absolute inset-0 flex items-center justify-center text-gray-400 text-xl font-semibold hover:bg-pink-100 transition duration-150">Click to Upload Photo</p>
            </div>
            
            <!-- Hidden File Input, triggered by clicking the photo container -->
            <label for="photoUpload" class="hidden">Upload a Square Image:</label>
            <input type="file" id="photoUpload" accept="image/*" class="hidden">
            
            <!-- REMOVED: Remove Photo button is now in settings.html -->
        </div>

        <!-- Timer Display Area (Conditional Display) -->
        <div id="timerContainer" class="w-full p-6 md:p-8 mb-8 hidden">
            <ul id="durationList" class="list-none p-0">
                <!-- List items generated by JS will go here --></ul>
        </div>
        
        <!-- Date Input Section (Always Visible) -->
        <div id="inputSection" class="p-4 bg-pink-50 rounded-xl border border-pink-200 shadow-md">
            <label for="startDate" class="block text-left text-sm font-semibold text-gray-700 mb-2">Set Our Start Date:</label>
            <input type="date" id="startDate" required 
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 mb-4 text-lg text-gray-700">
            
            <button id="setDateButton" 
                    class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 rounded-xl transition duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                Save Date
            </button>
        </div>

        <!-- Custom Notification Message Box -->
        <div id="messageBox" class="fixed top-4 right-4 z-50 p-3 bg-green-500 text-white rounded-lg shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none" role="alert">
            Date saved successfully!
        </div>

    </div>

    <script>
        // --- STORAGE KEYS (Updated to include NAMES and THEME) ---
        const STORAGE_KEY_DATE = '__relationship_start_date';
        const STORAGE_KEY_PHOTO = '__relationship_photo_data';
        const STORAGE_KEY_NAMES = '__relationship_names'; // New key for names
        const STORAGE_KEY_THEME = '__app_theme'; // New key for theme ('light' or 'dark')

        // --- DOM Elements ---
        const dateInput = document.getElementById('startDate');
        const dateButton = document.getElementById('setDateButton');
        const dateDisplay = document.getElementById('dateDisplay');
        const messageBox = document.getElementById('messageBox');
        const durationList = document.getElementById('durationList');
        const mainTitle = document.getElementById('mainTitle');
        const welcomeNames = document.getElementById('welcomeNames'); // New element

        // Photo Section DOM Elements
        const photoWrapper = document.getElementById('photoWrapper'); 
        const photoContainer = document.getElementById('photoContainer');
        const photoUploadInput = document.getElementById('photoUpload');
        const uploadedImage = document.getElementById('uploadedImage');
        const photoPlaceholder = document.getElementById('photoPlaceholder');
        // const removePhotoButton = document.getElementById('removePhotoButton'); // REMOVED

        
        // Conditional Display Elements
        const welcomeMessage = document.getElementById('welcomeMessage');
        const timerContainer = document.getElementById('timerContainer');


        let intervalId = null;

        // --- THEME MANAGEMENT ---
        /**
         * Applies the saved theme preference to the body element.
         */
        function applyTheme() {
            const savedTheme = localStorage.getItem(STORAGE_KEY_THEME) || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
            } else {
                document.body.classList.remove('dark');
            }
        }
        
        // --- NAMES MANAGEMENT ---
        /**
         * Loads and updates the title and welcome message with saved names.
         */
        function updateNamesDisplay() {
            const namesJson = localStorage.getItem(STORAGE_KEY_NAMES);
            let names = { name1: "User 1", name2: "User 2" };

            if (namesJson) {
                try {
                    names = JSON.parse(namesJson);
                } catch (e) {
                    console.error("Error parsing names from storage:", e);
                }
            }

            const titleText = `${names.name1} & ${names.name2}`;
            mainTitle.textContent = `${titleText} üíñ`;
            welcomeNames.textContent = titleText;
        }


        /**
         * Calculates the duration in Years, Months, Weeks, and Days based on 
         * precise date differences and updates the list display.
         */
        function calculateAndDisplayTime() {
            const startDateString = localStorage.getItem(STORAGE_KEY_DATE);
            durationList.innerHTML = ''; // Clear previous content
            
            if (!startDateString) {
                if (intervalId) clearInterval(intervalId);
                dateDisplay.textContent = "Your love story awaits!";
                
                // Show welcome message, hide content
                welcomeMessage.classList.remove('hidden');
                photoWrapper.classList.add('hidden');
                timerContainer.classList.add('hidden');
                return;
            }

            // Hide welcome message, show content
            welcomeMessage.classList.add('hidden');
            photoWrapper.classList.remove('hidden');
            timerContainer.classList.remove('hidden');


            const startDate = new Date(startDateString);
            const nowDate = new Date();
            
            // Handle if start date is in the future
            if (startDate.getTime() > nowDate.getTime()) {
                dateDisplay.textContent = `Awaiting our special day: ${startDate.toLocaleDateString()}`;
                durationList.innerHTML = '<li class="text-gray-500 text-base text-center">Counting down...</li>';
                return;
            }

            dateDisplay.textContent = `Since: ${startDate.toLocaleDateString()}`;

            // --- Calculation Logic (Accurate Years, Months, Weeks, Days) ---

            let years = nowDate.getFullYear() - startDate.getFullYear();
            let months = nowDate.getMonth() - startDate.getMonth();
            let days = nowDate.getDate() - startDate.getDate();

            // Adjust for month difference
            if (months < 0) {
                years--;
                months += 12;
            }

            // Adjust for day difference (this is the most complex part due to varying month lengths)
            let remainingDays;
            
            if (days < 0) {
                // We haven't completed the current month yet.
                months--; // Decrement the month count
                
                // Get the number of days in the previous month (the month we just completed)
                const lastMonth = new Date(nowDate.getFullYear(), nowDate.getMonth(), 0);
                const daysInPreviousMonth = lastMonth.getDate();
                
                // Remaining days is the days in the completed month plus the current day of this month
                remainingDays = daysInPreviousMonth + days; 
            } else {
                // If days >= 0, the remaining days are just the current difference
                remainingDays = days;
            }

            // Safety check for month underflow
            if (months < 0) {
                years--;
                months += 12;
            }

            // 2. Calculate Weeks and Remaining Days
            const weeks = Math.floor(remainingDays / 7);
            const finalDays = remainingDays % 7;

            // --- Update UI to List Format ---
            
            const units = [
                { value: years, label: 'Year' },
                { value: months, label: 'Month' },
                { value: weeks, label: 'Week' },
                { value: finalDays, label: 'Day' }
            ];
            
            if (years === 0 && months === 0 && weeks === 0 && finalDays === 0) {
                 // If the relationship started today
                 durationList.innerHTML = '<li class="text-gray-500 text-xl text-center font-semibold">Just started! Day one! ‚ù§Ô∏è</li>';
            } else {
                let displayedUnitsCount = 0;
                units.forEach(unit => {
                    // Only display units that have a non-zero value
                    if (unit.value > 0) { 
                        const label = unit.value === 1 ? unit.label : unit.label + 's';
                        const listItem = document.createElement('li');
                        
                        // Create the HTML structure: <span class="duration-value">5</span> Years
                        listItem.innerHTML = `<span class="duration-value">${unit.value.toLocaleString()}</span> ${label}`;
                        durationList.appendChild(listItem);
                        displayedUnitsCount++;
                    }
                });
                
                // If all units are zero but it's not "Day one!" (e.g. less than a day has passed but more than 0)
                if (displayedUnitsCount === 0 && (nowDate.getTime() - startDate.getTime() > 0)) {
                    durationList.innerHTML = '<li class="text-gray-500 text-xl text-center font-semibold">Less than a day! So fresh! ü•∞</li>';
                } else if (displayedUnitsCount === 0 && years === 0 && months === 0 && weeks === 0 && finalDays === 0) {
                     // This condition for "Day one!"
                }
            }
        }

        /**
         * Displays a temporary notification message.
         * @param {string} message - The message to display.
         * @param {string} bgColor - Tailwind background color class.
         */
        function showMessage(message, bgColor) {
            messageBox.textContent = message;
            // Reset colors
            messageBox.className = "fixed top-4 right-4 z-50 p-3 text-white rounded-lg shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none";
            // Apply new color
            messageBox.classList.add(bgColor);
            
            // Show message
            messageBox.classList.remove('opacity-0');
            messageBox.classList.add('opacity-100');

            // Hide message after 3 seconds
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
            }, 3000);
        }

        /**
         * Saves the date from the input field to localStorage and restarts the timer.
         */
        function saveDate() {
            const newDate = dateInput.value;
            if (newDate) {
                localStorage.setItem(STORAGE_KEY_DATE, newDate);
                showMessage("Our special date has been set!", "bg-green-600");
                initTimer(); // Restart the timer with the new date
            } else {
                showMessage("Please select a valid date first.", "bg-red-600");
            }
        }

        /**
         * Handles photo upload, converts to Base64, and saves to localStorage.
         */
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Image = e.target.result;
                    localStorage.setItem(STORAGE_KEY_PHOTO, base64Image);
                    displayPhoto(base64Image);
                    showMessage("Photo uploaded successfully!", "bg-green-600");
                };
                reader.readAsDataURL(file);
            }
        }

        /**
         * Displays the photo from a Base64 string.
         * Note: Removed logic for the remove button since it's now in settings.html.
         */
        function displayPhoto(base64Image) {
            if (base64Image) {
                uploadedImage.src = base64Image;
                uploadedImage.classList.remove('hidden');
                photoPlaceholder.classList.add('hidden');
            } else {
                uploadedImage.src = '';
                uploadedImage.classList.add('hidden');
                photoPlaceholder.classList.remove('hidden');
            }
        }


        /**
         * Initializes the app: loads theme, names, date input, photo display, and starts the timer.
         */
        function initTimer() {
            // Apply Theme first so the correct colors load immediately
            applyTheme();
            
            // Update names in the header and welcome message
            updateNamesDisplay(); 

            // Load existing date to pre-fill the input
            const existingDate = localStorage.getItem(STORAGE_KEY_DATE);
            if (existingDate) {
                dateInput.value = existingDate;
            }

            // Load and display existing photo
            const existingPhoto = localStorage.getItem(STORAGE_KEY_PHOTO);
            displayPhoto(existingPhoto);

            // Clear any existing interval to prevent duplicates
            if (intervalId) {
                clearInterval(intervalId);
            }

            // Run the calculation immediately and then set to run every 10 seconds 
            calculateAndDisplayTime();
            intervalId = setInterval(calculateAndDisplayTime, 10000); // Check every 10 seconds
        }

        // --- Event Listeners and Initialization ---

        dateButton.addEventListener('click', saveDate);
        photoUploadInput.addEventListener('change', handlePhotoUpload);
        // removePhotoButton.addEventListener('click', removePhoto); // REMOVED
        
        // New click handler: clicking the photo container opens the file dialog
        photoContainer.addEventListener('click', () => {
             photoUploadInput.click();
        });

        // Start the app when the window loads
        window.onload = initTimer;

    </script>
</body>
</html>
